<!doctype html>

<html>

  <head>
    <meta charset="utf-8">
    <title>WASM test</title>
  </head>

  <body>
    <body>
      <script>
        function loadWebAssembly(filename, imports) {
          // Fetch the file and compile it
          return fetch(filename)
            .then(response => response.arrayBuffer())
            .then(buffer => WebAssembly.compile(buffer))
            .then(module => {
              return new WebAssembly.Instance(module, imports);
            });
        }

        var importObject = {
            env: {
              '__memory_base': 0,
              'tableBase': 0,
              'memory': new WebAssembly.Memory({initial: 256}),
              'table': new WebAssembly.Table({initial: 256, element: 'anyfunc'}),
              abort: alert,
            }
        };

        loadWebAssembly('gcd.wasm', importObject)
        .then(instance => {
          var exports = instance.exports;
          var calculate_gcd = exports._calculate_gcd;
          var calculated_gcd = calculate_gcd(12, 15);
          console.log("calculated_gcd: ", calculated_gcd);
        });

      </script>
    </body>
  </body>

</html>
